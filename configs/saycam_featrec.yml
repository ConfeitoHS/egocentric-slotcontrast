experiment_group: saycam
experiment_name: train_saycam_video_featrec_only

globals:
  NUM_SLOTS: 11
  SLOT_DIM: 64
  DINO_MODEL: dino_s_vitb14
  FEAT_DIM: 768
  NUM_PATCHES: 256
  NUM_GPUS: 1
  BATCH_SIZE_PER_GPU: 64
  TOTAL_BATCH_SIZE: "${mul: ${.NUM_GPUS}, ${.BATCH_SIZE_PER_GPU}}"
  BASE_LR: 0.0001

trainer:
  max_steps: 100000
  log_every_n_steps: 2500
  val_check_interval: 2500
  gradient_clip_val: 0.05

optimizer:
  name: Adam
  lr: 0.0004
  lr_scheduler:
    name: exp_decay_with_warmup
    warmup_steps: 2500
    decay_steps: ${trainer.max_steps}

model:
  input_type: video
  visualize: false
  visualize_every_n_steps: 10000
  losses:
    loss_featrec:
      name: MSELoss
      pred_dims:
        - 0
        - ${globals.FEAT_DIM}
    # loss_ss:
    #   name: Slot_Slot_Contrastive_Loss
    #   pred_key: processor.state
    #   temperature: 0.1
    #   batch_contrast: true
    #   patch_inputs: false
    #   keep_input_dim: true

  loss_weights:
    loss_featrec: 1.0
    # loss_ss: 0.5

  initializer:
    name: FixedLearnedInit
    n_slots: ${globals.NUM_SLOTS}
    dim: ${globals.SLOT_DIM}

  encoder:
    backbone:
      name: TimmExtractor
      model: ${globals.DINO_MODEL}
      features:
      - vit_block12
      - vit_block_keys12
      frozen: true
      pretrained: true
      model_kwargs:
        dynamic_img_size: True
    output_transform:
      name: networks.two_layer_mlp
      inp_dim: ${globals.FEAT_DIM}
      outp_dim: ${globals.SLOT_DIM}
      hidden_dim: "${mul: ${globals.FEAT_DIM}, 2}"
      layer_norm: true

  grouper:
    name: SlotAttention
    inp_dim: ${globals.SLOT_DIM}
    slot_dim: ${globals.SLOT_DIM}
    n_iters: 2
    use_mlp: true

  latent_processor:
    first_step_corrector_args:
      n_iters: 3

  decoder:
    name: MLPDecoder
    inp_dim: ${globals.SLOT_DIM}
    outp_dim: ${globals.FEAT_DIM}
    hidden_dims: [1024, 1024, 1024]
    n_patches: ${globals.NUM_PATCHES}

  predictor:
    name: networks.TransformerEncoder
    dim: ${globals.SLOT_DIM}
    n_blocks: 1
    n_heads: 4

dataset:
  name: SAYCAMDataModule
  json_dir: "/home/wz3008/steve/"
  img_dir: "/saycam_transcript_5fps"
  img_size: 224
  ep_length: 10
  batch_size: 32
  num_workers: 2

